<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    tr:nth-child(even) {
  background-color: #2e2649;
}
tr:nth-child(odd) {
  background-color: #423b5b;
}
th {
  background-color: #342F44;
  color: white;
  padding: 10px;
}
td {
    color:white;
    border:none !important;
    padding: 10px;
}

input {
            width: 90%;
            height: 20px;
}

</style>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
<body>
    <div id="submit-button"></div>
    <table id="table"></table>
    <div id="list-container"></div>
    <script>

    const table = document.getElementById("table");
    function setDBList(items) {        
                // 테이블 헤더 생성
        var thead = document.createElement('thead');
        var trHead = document.createElement('tr');

        // 테이블 헤더에 속성 이름 추가 (첫 번째 아이템 기준)
        for (var prop in items[0]) {
            if (items[0].hasOwnProperty(prop)) {
                var th = document.createElement('th');
                th.textContent = prop;
                trHead.appendChild(th);
            }
        }
        
        thead.appendChild(trHead);
        table.appendChild(thead);

        // 테이블 바디 생성
        var tbody = document.createElement('tbody');

        // 배열의 각 아이템을 테이블 행으로 추가
        for (var i = 0; i < items.length; i++) {
            var tr = document.createElement('tr');
            for (var prop in items[i]) {
                if (items[i].hasOwnProperty(prop)) {
                    var td = document.createElement('td');
                    td.textContent = items[i][prop];
                    td.style.textAlign = "center";
                    tr.appendChild(td);
                }
            }

            // 삭제 버튼을 생성하고 클로저를 사용하여 해당 행의 ID 값을 가져옵니다.
            var td = document.createElement('td');
            const deleteButton = document.createElement("button");
            deleteButton.textContent = "삭제";
            deleteButton.className = "btn btn-danger";
            deleteButton.style.width = "60px";

            (function(idValue) {
                // 클로저 내에서 idValue를 참조하여 독립적인 값으로 설정합니다.
                deleteButton.addEventListener('click', function() {
                    inputValues["id"] = idValue;
                    console.log("ID 값:", idValue);

                    // 이제 inputValues 객체에 추가된 ID 값을 사용하여 작업을 수행합니다.
                    fetch("./dbserv", {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(inputValues)
                    })
                    .then(response => response.json())
                    .then(data => {
                        console.log(data);
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
                    location.href="db.html";
                });
            })(items[i]["id"]); // 클로저 함수 내에 idValue를 전달합니다.

            td.appendChild(deleteButton);
            tr.appendChild(td);
            tbody.appendChild(tr);
        }

        // 테이블에 tbody 추가
        table.appendChild(tbody);


        var inputValues = {};
        var theadRow = thead.querySelector('tr');
        theadRow.querySelectorAll('th').forEach(function(th) {
            var input = document.createElement('input');
            input.type = 'text'; // 또는 다른 유형의 입력 필드로 변경 가능
            var columnHeader = th.textContent; // 헤더 셀의 텍스트를 가져옴
            inputValues[columnHeader] = ''; // JSON 객체에 추가
            th.appendChild(input);
        });

        // 전송 버튼을 추가합니다.
        var submitButton = document.createElement('button');
        submitButton.textContent = '생성';
        submitButton.className = "btn btn-success"
        submitButton.style.width="60px"
        submitButton.style.margin="20px 10px 10px 10px"
        submitButton.addEventListener('click', function() {
            // JSON 객체에 저장된 입력 값을 업데이트합니다.
            theadRow.querySelectorAll('th input').forEach(function(input) {
                var columnHeader = input.parentElement.textContent;
                inputValues[columnHeader] = input.value;
            });

            fetch("./dbserv", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(inputValues)
            })
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                })
                .catch(error => {
                    console.error('Error:', error);
            }); 
            location.href="db.html";
            printList();
        });

        // // 버튼을 테이블 헤더에 추가합니다.
        // const submit = document.getElementById("submit-button");
        theadRow.appendChild(submitButton);
    };    

    function printList() {
        fetch("./dbserv", {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        })
            .then(response => response.json())
            .then(data => {
                console.log(data);        
                setDBList(data.list);
            })
            .catch(error => {
                console.error('Error:', error);
        });
    };
    printList();
    
    
    

    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
</body>
</html>